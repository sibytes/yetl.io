<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Data engineering framework to template data flow pipelines and implement transforms in python" name="description"/>
<meta content="Shaun Ryan" name="author"/>
<link href="https://yetl.io/project/" rel="canonical"/>
<link href=".." rel="prev"/>
<link href="../on-board-datafeed/" rel="next"/>
<link href="../assets/logo.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.6" name="generator"/>
<title>Project - YETL</title>
<link href="../assets/stylesheets/main.8608ea7d.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="pink" data-md-color-primary="pink" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#project">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="YETL" class="md-header__button md-logo" data-md-component="logo" href=".." title="YETL">
<img alt="logo" src="../assets/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            YETL
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Project
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="pink" data-md-color-media="" data-md-color-primary="pink" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="purple" data-md-color-media="" data-md-color-primary="purple" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/sibytes/yetl" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    sibytes/yetl
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="YETL" class="md-nav__button md-logo" data-md-component="logo" href=".." title="YETL">
<img alt="logo" src="../assets/logo.png"/>
</a>
    YETL
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/sibytes/yetl" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    sibytes/yetl
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Project
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Project
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#create-a-new-project">
<span class="md-ellipsis">
      Create a new project
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#project-config">
<span class="md-ellipsis">
      Project config
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#logging-config">
<span class="md-ellipsis">
      Logging config
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#sql">
<span class="md-ellipsis">
      SQL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pipeline">
<span class="md-ellipsis">
      Pipeline
    </span>
</a>
<nav aria-label="Pipeline" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#tables-files-the-what">
<span class="md-ellipsis">
      Tables &amp; Files - The What!
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pipeline-the-how">
<span class="md-ellipsis">
      Pipeline - The How!
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#summary">
<span class="md-ellipsis">
      Summary
    </span>
</a>
<nav aria-label="Summary" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration-stitching">
<span class="md-ellipsis">
      Configuration Stitching
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#jinja-rendering">
<span class="md-ellipsis">
      Jinja Rendering
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#validation">
<span class="md-ellipsis">
      Validation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#api">
<span class="md-ellipsis">
      API
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../on-board-datafeed/">
<span class="md-ellipsis">
    On-Board Datafeed
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
<span class="md-ellipsis">
    Reference
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/table-config/">
<span class="md-ellipsis">
    Table Config
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/python-api/">
<span class="md-ellipsis">
    Python API
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../about/">
<span class="md-ellipsis">
    About
    
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#create-a-new-project">
<span class="md-ellipsis">
      Create a new project
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#project-config">
<span class="md-ellipsis">
      Project config
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#logging-config">
<span class="md-ellipsis">
      Logging config
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#sql">
<span class="md-ellipsis">
      SQL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pipeline">
<span class="md-ellipsis">
      Pipeline
    </span>
</a>
<nav aria-label="Pipeline" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#tables-files-the-what">
<span class="md-ellipsis">
      Tables &amp; Files - The What!
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pipeline-the-how">
<span class="md-ellipsis">
      Pipeline - The How!
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#summary">
<span class="md-ellipsis">
      Summary
    </span>
</a>
<nav aria-label="Summary" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration-stitching">
<span class="md-ellipsis">
      Configuration Stitching
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#jinja-rendering">
<span class="md-ellipsis">
      Jinja Rendering
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#validation">
<span class="md-ellipsis">
      Validation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#api">
<span class="md-ellipsis">
      API
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset"><a class="md-content__button md-icon" download="Project.pdf" href="index.pdf" title="Download as PDF"><html><body><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m14 2 6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm4 18V9h-5V4H6v16zm-6-1-4-4h2.5v-3h3v3H16z"></path></svg></body></html></a><a class="md-content__button md-icon" href="index.pdf" target="_blank" title="View as PDF"><html><body><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 .41.12.8.34 1.12.07.11.16.21.25.29.36.37.86.59 1.41.59h7.53c-.53-.58-.92-1.25-1.18-2H6V4h7v5h5v3c.7 0 1.37.12 2 .34V8zm4 21 5-4.5-3-2.7-2-1.8v3h-4v3h4z"></path></svg></body></html></a>

<h1 id="project">Project</h1>
<p>Yetl has the concept of project. A project houses all the assets to configure your pipelines, the pipelines themselves and deploymemnt assets. They are deployable products that can be a data feed or an individual component data feed product of something larger.</p>
<p>Although it's entirely possible to reconfigure the project structure a canonical structure is recommended since the API just works without any additional consideration for all of these environments:</p>
<ul>
<li>Local</li>
<li>Databricks Workspace</li>
<li>Databricks Repo</li>
</ul>
<h2 id="create-a-new-project">Create a new project</h2>
<p>Yetl has a built-in cli for common tasks. One of those common tasks is creating a new project.</p>
<p>Create a python virtual environment and install yetl:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>mkdir<span class="w"> </span>yetl_test
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="nb">cd</span><span class="w"> </span>yetl_test
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="nb">source</span><span class="w"> </span>venv/bin/activate
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pip
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>pip<span class="w"> </span>install<span class="w"> </span>yetl-framework
</code></pre></div>
<p>Create a new yetl project:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>python<span class="w"> </span>-m<span class="w"> </span>yetl<span class="w"> </span>init<span class="w"> </span>test_yetl
</code></pre></div>
<p>This will create:</p>
<ul>
<li>logging configuration file <code>logging.yaml</code></li>
<li>yetl project configuration file <code>yetl_test.yaml</code> project configuration file.</li>
<li>Excel template <code>tables.xlsx</code> to curate tables names and properties that you want to load, this can be built into a configuration <code>tables.yaml</code> with <code>python -m yetl import-tables</code></li>
<li><code>json-schema</code> contains json schema that you can reference and use redhat's yaml plugin when crafting configuration to get intellisense and validation. There are schemas for:<ul>
<li><code>./pipelines/project.yaml</code></li>
<li><code>./pipelines/tables.yaml</code></li>
<li><code>./pipelines/&lt;my_pipelines&gt;.yaml</code></li>
</ul>
</li>
<li>directory structure to build pipelines</li>
</ul>
<p><img alt="yetl init project structure" src="../assets/yetl_init_project.png"/></p>
<ul>
<li>databricks - will store databricks workflows, notebooks, etc that will be deployed to databricks.</li>
<li>pipelines - will store yetl configuration for the data pipelines.</li>
<li>sql - if you choose to define some tables using SQL explicitly and have yetl create those tables then the SQL files will go in here.</li>
<li>schema - will hold the spark schema's in yaml for the landing data files when we autogenerate the schema's</li>
</ul>
<h2 id="project-config">Project config</h2>
<p>The <code>yetl_test.yaml</code> project file tells yetl where to find these folders. It's best to leave it on the defaults:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nt">databricks_notebooks</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./databricks/notebooks</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="nt">databricks_queries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./databricks/queries</span>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="nt">databricks_workflows</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./databricks/workflows</span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test_yetl</span>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="nt">pipeline</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./pipelines</span>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="nt">spark</span><span class="p">:</span>
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">        </span><span class="nt">spark.databricks.delta.allowArbitraryProperties.enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">        </span><span class="nt">spark.master</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
<a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">        </span><span class="nt">spark.sql.catalog.spark_catalog</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">org.apache.spark.sql.delta.catalog.DeltaCatalog</span>
<a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">        </span><span class="nt">spark.sql.extensions</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">io.delta.sql.DeltaSparkSessionExtension</span>
<a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">    </span><span class="nt">logging_level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ERROR</span>
<a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="nt">spark_schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./schema</span>
<a href="#__codelineno-2-14" id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="nt">sql</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./sql</span>
<a href="#__codelineno-2-15" id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.0.0</span>
</code></pre></div>
<p>It also holds a spark configuration, this is what yetl uses to create the spark session if you choose to run yetl code locally. This can be usefull for local development and testing in deveops pipelines. Since we are just leveraging pyspark and delta lake it's very easy to install a local spark environment however you will need java installed if you want to work this way.</p>
<p>The version attribute is also important this makes sure that you're using the right configuration schema for the specific version of yetl you're using. If these do not agree to the minor version then yetl will raise version incompatability errors. This ensures it's clear the metadata clearly denotes the version of yetl the it requires. Under the covers yetl uses pydantic to ensure that metadata is correct when deserialized.</p>
<h2 id="logging-config">Logging config</h2>
<p>The <code>logging.yaml</code> is the python logging configuration. Configure yetl logging as you please by altering this file.</p>
<h2 id="sql">SQL</h2>
<p>Sometimes there are requirements to explicitly create tables using SQL DDL statements. </p>
<p>For example if you're loading a fan in pattern where multiple source tables are loading into the same destination table in parallel you cannot create the schema from the datafeed on the fly, either with or without the merge schema option. This is because delta tables are optimistically isolated and attempting the change the schema in multiple process will mostly likely cause a <a href="https://docs.delta.io/latest/concurrency-control.html#metadatachangedexception">conflict</a>. This is common pattern for audit tracking tables when loading bronze and silver tables (raw and base stages respectively)</p>
<p>You may also just find it more practical to manage table creation by explicitly declaring create table SQL statements. You can also use this feature to create views.</p>
<p>In order to explicitly define tables or views using SQL:</p>
<ol>
<li>Create a folder in the <code>sql</code> directory that is the database name e.g. <code>my_database</code></li>
<li>Create a .sql file in the folder called the name of the table e.g. <code>my_table.sql</code></li>
<li>Put a deltalake compatible create SQL statement in the sql file</li>
</ol>
<p>e.g.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>./sql/my_database/my_table.sql
</code></pre></div>
<p>For <a href="https://github.com/sibytes/databricks-patterns/blob/main/header_footer/sql/yetl_control_header_footer/raw_audit.sql">example</a>, in this project we use this feature to create an audit tracking table for loading a ronze (raw) tables called <code>yetl_control_header_footer.raw_audit.sql</code>. </p>
<p>Note that if we want to declare the table unmanaged and provide an explicit location we can do using the jinja variable <code>{{location}}</code> which is defined in the pipeline configuration. See the SQL  documentation for full details and complete list of jinja variables supported.</p>
<h2 id="pipeline">Pipeline</h2>
<p>The pipline folder holds yaml files that describe the databases, tables, files and pipeline metadata that the yetl API will stitch, render and deserialize into an api that can be used to construct data pipelines using pyspark.</p>
<p>A lot of thought has gone into this design to make configuration creation and management as developer friendly and minimal as possible. There are 2 core types of files:</p>
<ol>
<li>Tables &amp; files - tables.yaml contains <strong>WHAT</strong> we are loading</li>
<li>Pipeline - {pipeline_pattern_name}.yaml contains <strong>HOW</strong> we are loading it</li>
</ol>
<h3 id="tables-files-the-what">Tables &amp; Files - The What!</h3>
<p>This configuration file contains the information of <strong>WHAT</strong> the database tables and files are that we want to load. What we mean by that, is that it's at the grain of the table and therefore each table can be configured differently if required. For example each table has it's own name. It doesn't contain any configuration of how the table is loaded.</p>
<p>One table definition file is allowed per project. Each file can hold definitions for any number of tables for databases at the following data stages. Database table type can be <code>read</code> (spark read api for various formats) or <code>delta_lake</code>:</p>
<ul>
<li><code>audit_control</code> - <code>delta_lake</code></li>
<li><code>source</code> - <code>read</code> or <code>delta-lake</code></li>
<li><code>landing</code> - <code>read</code></li>
<li><code>raw</code> (bronze) - <code>delta-lake</code></li>
<li><code>base</code> (silver) - <code>delta-lake</code></li>
<li><code>curated</code> (gold) - <code>delta-lake</code></li>
</ul>
<p>Typically <code>read</code> table types would be used in <code>landing</code> and <code>delta-lake</code> tables for everything else. <code>source</code> may not normally be required for Databricks pipelines since data will be landed using some other cross domain data orchestration tool e.g. Azure Data Factory. However yetl does support <code>source</code> for <code>read</code> and <code>delta-lake</code> tables types it can be usefull when:</p>
<ul>
<li>data doesn't need to be landed and is available from some via a spark source</li>
<li>migrating tables from an older deltalake into a new architecute e.g. Unity Catalog migration</li>
<li>landing data directly from api's</li>
</ul>
<p>It is therefore opinionated about the basic levels that should be implemented in terms of stages and follows the medallion lakehouse arhitecture. It's rigidity starts and ends there however; you can put what ever tables you want in any layer, in any datbase with dependencies entirely of your own choosing.</p>
<p><a href="https://github.com/sibytes/databricks-patterns/blob/main/ad_works_lt/pipelines/tables.yaml">tables.yaml example</a></p>
<p>By far the biggest hurdle is defining the table configuration. To rememedy this the yetl CLI tool has command to convert an Excel document into the required yaml format. Curating this information in Excel is far more user friendly than a yaml document for large numbers of tables. See the pipeline documentation for full details.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>python<span class="w"> </span>-m<span class="w"> </span>yetl<span class="w"> </span>import-tables<span class="w"> </span>./pipelines/tables.xlsx<span class="w"> </span>./pipelines/tables.yaml
</code></pre></div>
<p><a href="https://github.com/sibytes/databricks-patterns/blob/main/ad_works_lt/pipelines/tables.xlsx">tables.xlsx</a> -&gt; <a href="https://github.com/sibytes/databricks-patterns/blob/main/ad_works_lt/pipelines/tables.yaml">tables.yaml</a></p>
<h3 id="pipeline-the-how">Pipeline - The How!</h3>
<p>This configuration file contains pipeline configuration properties that describes <strong>HOW</strong> the tables are loaded. For a given feed that is landed and loaded to silver (base) tables a lot of these are the same for every table in the feed. There can be more than one of these files for a given project. In other words you can define more than one way to load your tables and parameterise the pattern in the pipeline.</p>
<p>An example use case of this might be to batch load a large migration dataset; then turn on autoloader and event load incrementals from that position onwards.</p>
<p><a href="https://github.com/sibytes/databricks-patterns/blob/main/ad_works_lt/pipelines/batch.yaml">batch.yaml pipeline example</a></p>
<h2 id="summary">Summary</h2>
<p>So what does yetl do that provides value, since all we have is a bunch of configuration files:</p>
<ol>
<li>Configuration Stitching</li>
<li>Jinja Rendering</li>
<li>Validation</li>
<li>API</li>
</ol>
<h3 id="configuration-stitching">Configuration Stitching</h3>
<p>It stitches the table and pipeline data together using a minimal python idioms and provides easy access to the table collections and pipeline properties. Some properties fall on a gray line in the sense that sometimes they are the same for all tables but on specific occaisions you might want them to be different. For example deltalake properties. You can define them in the pipeline doc but override them if you want on specific tables.</p>
<h3 id="jinja-rendering">Jinja Rendering</h3>
<p>There are some jinja templating and features built into the configuration deserialization. This can avoid repetition allowing for easier maintenance; or provide enhanced functions around injecting time slice parameters of a specific format into file paths. See the pipeline documentation for specific details.</p>
<h3 id="validation">Validation</h3>
<p>When yetl uses pydantic to validate and desrialize the configuration data making it robust, easy to use and easy to extend and support.</p>
<h3 id="api">API</h3>
<p>The yetl API exposes the validated, stitched and rendered configuration into an easy to use API that can used to implement modular pipelines exactly how you want to. <strong>Yetl does not take over specifically the way engineers want to build and test their pipelines</strong>.</p>
<p>It does however provide an easy to use API to iterate and access the metadata you need. The tables are indexed and can easily be retrieved or iterated. So you can build your custom pyspark pipelines or even just ignore some of the managed table properties and iterate the tables to create DLT pipelines in databricks.</p>

</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright Â© 2021 - 2023 Shaun Ryan
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
</body>
</html>